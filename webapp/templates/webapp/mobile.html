{% extends "webapp/base.html" %}
{% block content %}
{%load static from staticfiles%}

<nav class="navbar navbar-inverse">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>                        
            </button>
            <a class="navbar-brand" href="#">Mobile Analytics</a>
          </div>
          <div class="collapse navbar-collapse" id="myNavbar">
            <ul class="nav navbar-nav">
             
              <li><a href="{%url 'mobileview'%}">Home</a></li>
              <li><a href="#" >About</a></li>
              {% if  user.is_authenticated %}
              <li><p id="username">{{ user.get_username }}</p></li>
              <li><a href="{% url 'logout'%}">Logout</a></li>   
              {% else %}
              <li><a href="{% url 'login'%}?next={{request.path}}">Login</a></li>   
              {% endif %}  
            </ul>
            <!--<ul class="nav navbar-nav navbar-right">
              <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
            </ul>-->
          </div>
        </div>
      </nav>
        
      <div class="container-fluid text-center">    
        <div class="row content">
          <div class="col-sm-2 sidenav">
                <ul class="sidebar-nav">
                        <li class="sidebar-brand">
                            <a href="#">
                                Mobile Phones   
                            </a>
                        </li>
                        
                        {% if  user.is_superuser %}
                        <li ><a href="{%url 'admin_setup'%}">Advance Search Setup</a></li>
                        {% else %}
                        <li>
                            <a href="{% url 'filter'  %}">ADVANCED SEARCH</a>
                        </li>
                        {%endif%}
                        
                       
                        <li>
                            <a href="#">SAMSUNG</a>
                        </li>
                        <li>
                            <a href="#">QMOBILE</a>
                        </li>
                        <li>
                            <a href="#">OPPO</a>
                        </li>
                        <li>
                            <a href="#">HUAWEI</a>
                        </li>
                        <li>
                            <a href="#">IPHONE</a>
                        </li>
                       
                        
                    </ul>
          </div>
        <div class="col-sm-9  col-md-9 col-lg-9 col-xs-9 text-left" > 
              
            <div class="latest-product-section"> 
                    {%  for mob in mobiles  %}
   
                    {% if forloop.counter0|divisibleby:3 %} 
                    <div class="row text-center"> {%  endif %}
                           
                            <div class="col-md-4 col-lg-4 col-xs-12 sm-margin-b-50 pull-left">
                                    <div class="margin-b-20" >
                                    <h4>Compare</h4>
                                    <input type="checkbox" value={{mob.id}} id={{mob.id}} name={{mob.id}}-{{mob.Mobile_Name}}  onchange="toggleCheckbox(this)"> 
                                  <img class="img-responsive" src="{% static mob.imagepath1 %}"  alt="Latest Products Image"  title=""/>
                                        </div>
                               <!-- <h4> <span class="text-uppercase margin-l-20">{{mob.Mobile_Name}}</span></h4>-->

                                    <h4><a href="{% url 'mobileinfo' id=mob.id %}">{{mob.Mobile_Companny}}</a> <span class="text-uppercase margin-l-20">{{mob.Mobile_Name}}</span></h4>
                                    <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> Price </a><span class="text-uppercase margin-l-20">{{mob.price}}</span></h4>
                                    <h4>{{mob.os}}</h4>
                                    <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> Size </a><span class="text-uppercase margin-l-20">{{mob.Size}}-Inch</span></h4>
                                    <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> Color </a><span class="text-uppercase margin-l-20">{{mob.Colors}}</span></h4>
                                    <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> Cpu </a><span class="text-uppercase margin-l-20">{{mob.Cpu}}</span></h4>
                                                                        <h4><a href = "{% url 'mobileinfo' id=mob.id %}"> OS </a><span class="text-uppercase margin-l-20">{{mob.OS}}</span></h4>
                                  
                                    <a class="link btn btn-success" href="{% url 'mobileinfo' id=mob.id %}">Read More</a>
                                   
                            </div>
                {%  if forloop.counter|divisibleby:3 or forloop.last %}
                    </div><!-- row closing --><hr>
                    {%  endif %}
                {%  endfor %}
               
                
                  
            </div>                 
                            
               
          </div>
          <div class="col-sm-1 sidenav">
            <div class=""   id="lc">
                  
            </div>
          </div>
        </div>
      </div>
      
      <footer class="container-fluid text-center">
      
        <div class="pagination" >
                <span class="step-links">
                    {% if mobiles.has_previous %}
                        <a href="?page=1">&laquo; first</a>
                        <a href="?page={{ mobiles.previous_page_number }}">previous</a>
                    {% endif %}
                    
                    <span class="current">
                        Page {{ mobiles.number }} of {{ mobiles.paginator.num_pages }}.
                    </span>
                
                    {% if mobiles.has_next %}
                        <a href="?page={{ mobiles.next_page_number }}">next</a>
                        <a href="?page={{ mobiles.paginator.num_pages }}">last &raquo;</a>
                    {% endif %}
                </span>
            </div>
      </footer>

    <script>
        var arr=[];
       
        window.addEventListener( "pageshow", function ( event ) {
        var historyTraversal = event.persisted || 
        ( typeof window.performance != "undefined" && 
        window.performance.navigation.type === 2 );
                if ( historyTraversal ) {
                window.location.reload();
            }
        });
        function toggleCheckbox(element){      
        if (element.checked == true){
        console.log(element.id);
         
            if (arr.length ===3){
                alert("Array full ");
                element.checked=false;
            }
            else {
                    arr.push(element.id);
            }
        } 
        else {            
            arr.pop(element.id);
        }
        function myfunc(){ 
            console.log("button clicked");
            $.ajax({
                    type: 'POST',
                    dataType: "json",
                   
                    'data': {
                    'd': JSON.stringify(arr),
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    
                    },
                    url: "{% url 'sm' %}",
                    success: function(response){
                        console.log(response);
                        window.location="{%url 'cart'%}"
                     
                    
                    }
                    
                    });
           
                   
            // get arr and send it to view. 
            // according to the id display the result in a table
        }
        $(document).ready(function () {
                // alert(JSON.stringify(arr));
               
                if(arr.length>1){
                var elem=document.getElementById('l');
                    if (elem===null)  {
                       
                        var btn = document.createElement("BUTTON");
                        btn.id="l";
                        var t = document.createTextNode("Compare");  
                        btn.appendChild(t);
                        btn.onclick=myfunc;
                        document.getElementById('lc').appendChild(btn);     
                        $('#l').addClass('btn'); 
                        $('#l').addClass('btn-success');   
                        $('#l').addClass('btn-success-edit');        
                        
                    }
                }
                else if (arr.length <=1 ){
                    console.log("in condition");
                    var elem=document.getElementById('l');
                    
                   if (elem!==null){
                    document.getElementById('l').remove();
                   }
                }
        });
 }  


     </script>
{%endblock%}